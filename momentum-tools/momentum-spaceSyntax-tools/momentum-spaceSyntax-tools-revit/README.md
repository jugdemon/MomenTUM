## General Information
Space Syntax is a technique to analyse spatial configurations of urban or closed spaces. This Add-In visualizes space syntax results generated by momentum for a properly modelled Revit project.

## User Guide
There is no pre-compiled Space Syntax Add-Ins for Revit available. If you want to use the Plugin, you have to compile the Add-In yourself. 
The some steps have to be taken:

1 Install Autodesk Revit (2015 +), ILMerge and a C# IDE (i.e. Visual Studio 2015 +)

2 Clone the Momentum repository or the project

3 Open the solution in your IDE, go to project references and add 'RevitAPI.dll' and 'RevitAPIUI' from your local Revit installation
(Hint: dlls are usually located in 'Program Files/Autodesk/Revit 20XX/')

4 Open the post-build events in the project and adapt the paths to ILMerge and the Revit dll folders (usually you just need to replace the revit version)

5 Check for build errors in the post-bulid and fix them according to the message provided by MS Build.

6 Start Revit and confirm that you trust the authors of the plugin and check if the External Command 'MomentumV2SpaceSyntax' under the 'Add-Ins' Tab in Revit shows up.

Note: The plugin requires the Revit Visualization Framework, which is available since Revit 2015+.

## Add-In Workflow
The workflow assumes, that you have successfully build the Revit Laoyuting Plugin and the Space Syntax Plugin and integrated them into your Revit installation. Furthermore you need to have built Momentum successfully and have a basic understanding of its usage (see momentum-documentation).

1 Use the Layouting Plugin to export geometry data of a level of a project into an xml file. Make sure that you have properly set rooms in your revit project (see layouting documentation). 

2 Check if the resulting xml contains at least one area of type 'Origin' per scenario node.
(If there is none, you have to create a node that defines four points, that define a bounding box which lies within a room.)

3 Create a xml configuration file and insert a lattice, space syntax and a outputwriter configuration.
(Hint: You can copy paste the spaceSyntaxExamples.xml and make sure to adapt the file paths and ids accordingly.)

4 Run your configuration with Momentum (see momentum-documentation) and check if the execution produced the xml output file defined in the space syntax output writer.

5 In Revit in the same project, go to 'Add-Ins' tab and run the MomentumV2SpaceSyntax external command and select the space syntax result xml you just created with Momentum.

6 If you created the xml result using the Revit Layouting plugin, the Space Syntax plugin will automatically select the correct level to visualize the result from metadata in the result xml. Otherwise, a level picker will open.

Note: The plugin will always try to visualize the result in the currently opened view. If the level is not available in the current view, an error is shown.

## Known Limits / Developer Todos
* Rooms must have an underlying floor, otherwise the result will not be visualized.
* Currently only one floor object is automatically selected for visualization (instead of multiple floor instances).
* Only one level/scenario can be loaded at once.
* The plugin is dependent on the accuracy of the layouting plugin.
* The plugin is dependent on Momentum

## Developer Guide

Start with 'My First Plugin Training' for Autodesk Revit to understand the most basic concepts of how plugins are written for Revit (check the link below).

The entry point for the plugin is the MomentumV2SpaceSyntax class. This class outlines the general plugin workflow. All logic and user-interaction is handeled in service classes (Service folder) which also handle displaying information and errors to the user. 

The Model folder consists of an object model that corresponds to the xml structure of the xml that is to be parsed.

The View and ViewModel folder represent graphical user interface for the level picker. The levelpicker is composed of a WinForm which hosts WPF user control. The code is intended to respect the MVVM pattern for separation of graphical user interface (View folder) and interaction logic (ViewModel). The MVVM Model in our case is the Level class provided by Revit.

If any more external librarys (or nuget packages) are needed, you have to add them into the ilmerge post-build process. Otherwise you have to copy the references by hand into the plugin folder of Revit and make sure the paths are correct.

## Developer Todos
* Find a way to get the floor on which a room is placed in order to have a visualization for every room.
* Combine the SpaceSyntax and Layouting Plugin into one Project to simplify the visualization workflow  and register a Ribbon.

## Useful Links

[My First Plugin Training by Autodesk](http://usa.autodesk.com/adsk/servlet/index?siteID=123112&id=16459234) is the first and best start into developing a Revit Add-In. 
[Revit SDK](http://usa.autodesk.com/adsk/servlet/index?siteID=123112&id=2484975) provides code examples for a wide range of Revit functionality.

[Official Revit API Documentation](http://www.revitapidocs.com/) sometimes provides example code for classes and methods.

[Jeremy Tammik](https://github.com/jeremytammik) is well experienced with the Revit API and has an useful [Blog](http://thebuildingcoder.typepad.com/) where he publishes discussions on Add-Ins. In his [Github Repository](https://github.com/jeremytammik) many helpful projects are published. A useful tool is [RevitLookup](https://github.com/jeremytammik/RevitLookup). It allows to dynamically look into Revit objects at runtime and can help understanding the RevitAPI.

[Revit API Forum](https://forums.autodesk.com/t5/revit-api-forum/bd-p/160)

[Stackoverflow Revit-API Tag](https://stackoverflow.com/tags/revit-api/info) 
